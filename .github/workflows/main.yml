- name: Create screenshot.js
  run: |
    mkdir -p scripts
    cat > scripts/screenshot.js << 'EOF'
    const puppeteer = require('puppeteer');

    (async () => {
      try {
        console.log("Launching browser...");
        const browser = await puppeteer.launch({
          args: ['--no-sandbox', '--disable-setuid-sandbox', '--disable-gpu']
        });

        const page = await browser.newPage();
        await page.setViewport({ width: 1920, height: 1080 });

        console.log("Navigating to the page...");
        await page.goto('https://www.nea.gov.sg/weather/rain-areas', {
          waitUntil: 'networkidle2',
          timeout: 60000
        });

        // Wait a bit more for layout/sticky header to stabilize
        await page.waitForTimeout(3000);

        // Scroll to the top if needed
        await page.evaluate(() => window.scrollTo(0, 0));

        // Create a timestamped filename
        const now = new Date();
        const isoString = now.toISOString().split('.')[0].replace(/:/g, "-") + "Z";
        const filePath = `screenshot_archive/rain-areas-${isoString}.png`;

        // Take a full-page screenshot
        await page.screenshot({ path: filePath, fullPage: true });
        console.log(`Screenshot saved as ${filePath}`);

        await browser.close();
      } catch (err) {
        console.error("Error encountered:", err);
        process.exit(1);
      }
    })();
    EOF
